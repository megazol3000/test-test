const screenLink = document.querySelector(".screen__link"),
      burger = document.querySelector(".nav__burger"),
      nav = document.querySelector(".nav"),
      arrow = document.querySelector(".nav__arrow"),
      screen = document.querySelector(".screen"),
      navList = document.querySelector(".test-list"),
      ul = document.querySelector(".test-list__ul"),
      mobileBurger = document.querySelector(".mobile-nav__burger"),
      mobileArrow = document.querySelector(".mobile-nav__arrow"),
      screenBegin = document.querySelector(".screen-begin"),
      screenContent = document.querySelector(".screen-content"),
      testsArray = [{
  id: 1,
  name: "Test's name",
  description: "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer ullamcorper volutpat tristique. Fusce et nunc porttitor, pretium urna at, sagittis purus. Nullam sagittis congue sapien non sodales. Aliquam vel condimentum lacus, sit amet feugiat velit. Suspendisse congue imperdiet dui, sit amet cursus mi viverra sed. Nam porttitor venenatis vehicula. Vestibulum sed arcu vel lorem venenatis tempor.",
  timer: 0,
  questions: [["Вопрос 1", "Вариант А", "Вариант Б", "Вариант В", "Вариант Г", "Вариант Д", "Вариант Е", "Вариант Б", "Не ответили"], ["Вопрос 2", "Вариант А", "Вариант Б", "Вариант В", "Вариант Г", "Вариант Д", "Вариант Е", "Вариант А", "Не ответили"], ["Вопрос 3", "Вариант А", "Вариант Б", "Вариант В", "Вариант Г", "Вариант Д", "Вариант Е", "Вариант Е", "Не ответили"], ["Вопрос 4", "Вариант А", "Вариант Б", "Вариант В", "Вариант Г", "Вариант Д", "Вариант Е", "Вариант Д", "Не ответили"], ["Вопрос 5", "Вариант А", "Вариант Б", "Вариант В", "Вариант Г", "Вариант Д", "Вариант Е", "Вариант В", "Не ответили"]]
}, {
  id: 2,
  name: "Another Test",
  description: "Integer ullamcorper volutpat tristique. Fusce et nunc porttitor, pretium urna at, sagittis purus. Nullam sagittis congue sapien non sodales. Aliquam vel condimentum lacus, sit amet feugiat velit. Suspendisse congue imperdiet dui.",
  timer: 0,
  questions: [["Вопрос 1", "Вариант А", "Вариант Б", "Вариант В", "Вариант Г", "Вариант Д", "Вариант Е", "Вариант В", "Не ответили"], ["Вопрос 2", "Вариант А", "Вариант Б", "Вариант В", "Вариант Г", "Вариант Д", "Вариант Е", "Вариант В", "Не ответили"], ["Вопрос 3", "Вариант А", "Вариант Б", "Вариант В", "Вариант Г", "Вариант Д", "Вариант Е", "Вариант А", "Не ответили"]]
}, {
  id: 3,
  name: "Test",
  description: "Aliquam vel condimentum lacus, sit amet feugiat velit. Suspendisse congue imperdiet dui.",
  timer: 0,
  questions: [["Вопрос 1", "Вариант А", "Вариант Б", "Вариант В", "Вариант Г", "Вариант Д", "Вариант Е", "Вариант Б", "Не ответили"], ["Вопрос 2", "Вариант А", "Вариант Б", "Вариант В", "Вариант Г", "Вариант Д", "Вариант Е", "Вариант А", "Не ответили"], ["Вопрос 3", "Вариант А", "Вариант Б", "Вариант В", "Вариант Г", "Вариант Д", "Вариант Е", "Вариант Е", "Не ответили"], ["Вопрос 4", "Вариант А", "Вариант Б", "Вариант В", "Вариант Г", "Вариант Д", "Вариант Е", "Вариант Д", "Не ответили"], ["Вопрос 5", "Вариант А", "Вариант Б", "Вариант В", "Вариант Г", "Вариант Д", "Вариант Е", "Вариант В", "Не ответили"], ["Вопрос 6", "Вариант А", "Вариант Б", "Вариант В", "Вариант Г", "Вариант Д", "Вариант Е", "Вариант Б", "Не ответили"], ["Вопрос 7", "Вариант А", "Вариант Б", "Вариант В", "Вариант Г", "Вариант Д", "Вариант Е", "Вариант А", "Не ответили"], ["Вопрос 8", "Вариант А", "Вариант Б", "Вариант В", "Вариант Г", "Вариант Д", "Вариант Е", "Вариант Е", "Не ответили"], ["Вопрос 9", "Вариант А", "Вариант Б", "Вариант В", "Вариант Г", "Вариант Д", "Вариант Е", "Вариант Д", "Не ответили"], ["Вопрос 10", "Вариант А", "Вариант Б", "Вариант В", "Вариант Г", "Вариант Д", "Вариант Е", "Вариант В", "Не ответили"], ["Вопрос 11", "Вариант А", "Вариант Б", "Вариант В", "Вариант Г", "Вариант Д", "Вариант Е", "Вариант В", "Не ответили"]]
}, {
  id: 4,
  name: "Название теста",
  description: "Aliquam vel condimentum lacus, sit amet feugiat velit. Suspendisse congue imperdiet dui.",
  timer: 0,
  questions: [["Вопрос 1", "Вариант А", "Вариант Б", "Вариант В", "Вариант Г", "Вариант Д", "Вариант Е", "Вариант Б", "Не ответили"], ["Вопрос 2", "Вариант А", "Вариант Б", "Вариант В", "Вариант Г", "Вариант Д", "Вариант Е", "Вариант А", "Не ответили"], ["Вопрос 3", "Вариант А", "Вариант Б", "Вариант В", "Вариант Г", "Вариант Д", "Вариант Е", "Вариант Е", "Не ответили"], ["Вопрос 4", "Lorem ipsum dolor sit amet, consectetur adipiscing elit.", "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam sollicitudin odio sit amet.", "Lorem ipsum dolor sit amet, aliquam sollicitudin odio sit amet.", "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam sollicitudin odio sit amet.", "Lorem ipsum dolor sit amet, aliquam sollicitudin odio sit amet.", "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam sollicitudin odio sit amet.", "Lorem ipsum dolor sit amet, aliquam sollicitudin odio sit amet.", "Не ответили"]]
}];
localStorage.setItem("allTests", JSON.stringify(testsArray));
const raw = localStorage.getItem("allTests"),
      tests = JSON.parse(raw);
console.log(tests);

for (let e = 0; e < tests.length; e++) ul.innerHTML += `<li class="test-list__item">${tests[e].name}</li>`;

const navListItems = document.querySelectorAll(".test-list__item");

for (let e = 0; e < navListItems.length; e++) navListItems[e].addEventListener("click", () => {
  window.screen.width < 700 && closeNav(), screenContent.innerHTML = `\n        <div class="screen-description">\n            <div class="screen-description-title">Описание</div>\n            <div class="screen-description-text">\n                <p>\n                    ${tests[e].description}\n                </p>\n            </div>\n            <div class="screen-description-buttons">\n                <button class="btn begin-test">Начать</button><button class="btn cancel">Отмена</button>\n            </div>\n        </div>\n    `;
});

function testDescription() {
  screenContent.innerHTML = '\n    <div class="screen-begin">\n        <a class="screen__link" href="#">Выберите тест из списка</a>\n    </div>';
  document.querySelector(".screen__link").addEventListener("click", openNav);

  for (let e = 0; e < navListItems.length; e++) navListItems[e].classList.remove("test-list__item_active");
}

function testContent() {
  closeNav();

  for (let t = 0; t < navListItems.length; t++) if (navListItems[t].classList.contains("test-list__item_active")) {
    let s = '<span class="header-counter">0</span>';
    screenContent.innerHTML = `\n            <div class="screen-test">\n                <div class="screen-test-title">\n                    <div class="screen-test-title1"><button class="exit-btn test-btn">Выход</button></div>\n                    <h2> ${tests[t].name}</h2>\n                    <div class="test-nav">\n                        <button class="clear test-btn">Сбросить все ответы</button>\n                        <span class="test-counter">${s}/${tests[t].questions.length}</span>\n                        <span class="test-timer">00:00:00</span>\n                    </div>\n                </div>\n                <div class="screen-test-forms">\n                <div class="screen-test-result">\n                </div>\n                    \n                </div>\n                <div class="screen-test-footer">\n                    <button class="btn complete-test">Завершить</button>\n                </div>\n            </div>\n            `;
    const n = document.querySelector(".screen-test-forms"),
          i = document.querySelector(".test-timer");
    let r = 0,
        o = 0,
        l = 0;

    function e() {
      l <= 8 ? i.innerHTML = `0${r}:0${o}:0${l += 1}` : l >= 9 && l <= 58 ? i.innerHTML = `0${r}:0${o}:${l += 1}` : l >= 59 && (l = -1, o += 1, i.innerHTML = `0${r}:0${o}:0${l += 1}`);
    }

    setInterval(e, 1e3);

    for (let e = 0; e < tests[t].questions.length; e++) {
      n.innerHTML += `\n                <p class="form-question">${tests[t].questions[e][0]}</p>\n                <form class="form">\n                    <div class="form-inputs">\n                    <input class="radio" type="radio" id="${"var" + e}" name="${"var" + e}" value="${tests[t].questions[e][1]}"><label for="${"var" + e}">${tests[t].questions[e][1]}</label>\n                    <input class="radio" type="radio" id="${"var" + e + 1}" name="${"var" + e}" value="${tests[t].questions[e][2]}"><label for="${"var" + e + 1}">${tests[t].questions[e][2]}</label>\n                    <input class="radio" type="radio" id="${"var" + e + 2}" name="${"var" + e}" value="${tests[t].questions[e][3]}"><label for="${"var" + e + 2}">${tests[t].questions[e][3]}</label>\n                    <input class="radio" type="radio" id="${"var" + e + 3}" name="${"var" + e}" value="${tests[t].questions[e][4]}"><label for="${"var" + e + 3}">${tests[t].questions[e][4]}</label>\n                    <input class="radio" type="radio" id="${"var" + e + 4}" name="${"var" + e}" value="${tests[t].questions[e][5]}"><label for="${"var" + e + 4}">${tests[t].questions[e][5]}</label>\n                    <input class="radio" type="radio" id="${"var" + e + 5}" name="${"var" + e}" value="${tests[t].questions[e][6]}"><label for="${"var" + e + 5}" style="margin:0;">${tests[t].questions[e][6]}</label>\n                   </div>\n                </form>`;
      const s = document.querySelector(".clear"),
            i = document.querySelectorAll(".radio");
      let r = 0;
      const o = document.querySelector(".header-counter");

      for (let e = 0; e < i.length; e++) i[e].addEventListener("change", () => {
        r < tests[t].questions.length && (r += 1, o.innerHTML = r), s.addEventListener("click", () => {
          r = 0, o.innerHTML = r;

          for (let e = 0; e < i.length; e++) i[e].checked = !1;
        });
      });
    }

    document.querySelector(".complete-test").addEventListener("click", () => {
      const e = document.querySelectorAll(".form-inputs");

      for (let s = 0; s < e.length; s++) for (let n = 0; n < 12; n++) e[s].childNodes[1].checked ? tests[t].questions[s][8] = e[s].childNodes[1].value : e[s].childNodes[4].checked ? tests[t].questions[s][8] = e[s].childNodes[4].value : e[s].childNodes[7].checked ? tests[t].questions[s][8] = e[s].childNodes[7].value : e[s].childNodes[10].checked ? tests[t].questions[s][8] = e[s].childNodes[10].value : e[s].childNodes[13].checked ? tests[t].questions[s][8] = e[s].childNodes[13].value : e[s].childNodes[16].checked && (tests[t].questions[s][8] = e[s].childNodes[16].value);

      n.innerHTML = '<div class="screen-test-result"></div>';
      const s = document.querySelector(".screen-test-result");
      s.style.height = "115px";
      let i = 0;

      for (let e = 0; e < tests[t].questions.length; e++) tests[t].questions[e][7] == tests[t].questions[e][8] && (i += 1);

      s.innerHTML = `\n                        <h2>Тест завершен</h2>\n                        <span>вы ответили правильно на ${i} вопросов из ${tests[t].questions.length}</span>\n                        <p>Ваши ответы</p>\n                    `;

      for (let e = 0; e < tests[t].questions.length; e++) n.innerHTML += `\n                        <div class="screen-result-item">\n                        <p class="form-question">${tests[t].questions[e][0]}</p>\n                                <span>Правильный ответ: ${tests[t].questions[e][7]}</span>\n                                <span>Вы ответили: ${tests[t].questions[e][8]}</span>\n                        </div>\n                        `;

      document.querySelector(".screen-test-footer").innerHTML = '<button class="btn again">Пройти еще раз</button>';
      const r = document.querySelector(".again");
      r.addEventListener("click", testContent), r.addEventListener("click", () => {
        for (let e = 0; e < tests[t].questions.length; e++) tests[t].questions[e][8] = "Не ответили";
      });
    });
  }

  const t = document.querySelector(".exit-btn"),
        s = document.querySelector(".dark-wrap");
  t.addEventListener("click", () => {
    s.style.display = "block";
    const e = document.querySelector(".form-exit");
    document.querySelector(".form-cancel").addEventListener("click", () => {
      s.style.display = "none";
    }), e.addEventListener("click", () => {
      testDescription(), s.style.display = "none";
    });
  });
}

function openNav() {
  burger.classList.remove("nav__burger_active"), mobileBurger.classList.remove("mobile-nav__burger_active"), mobileArrow.classList.add("mobile-nav__arrow_active"), nav.classList.add("screen__nav_active"), screen.classList.add("screen_slim"), navList.classList.remove("test-list_invisible");
}

function closeNav() {
  burger.classList.add("nav__burger_active"), mobileBurger.classList.add("mobile-nav__burger_active"), mobileArrow.classList.remove("mobile-nav__arrow_active"), burger.classList.add("nav__burger_active"), nav.classList.remove("screen__nav_active"), screen.classList.remove("screen_slim"), navList.classList.add("test-list_invisible");
}

screenLink.addEventListener("click", openNav), burger.addEventListener("click", openNav), arrow.addEventListener("click", closeNav), mobileArrow.addEventListener("click", closeNav), mobileBurger.addEventListener("click", openNav);

for (let e = 0; e < navListItems.length; e++) navListItems[e].addEventListener("click", () => {
  screenBegin.classList.add("screen-description");

  for (let e = 0; e < navListItems.length; e++) navListItems[e].classList.remove("test-list__item_active");

  navListItems[e].classList.toggle("test-list__item_active");
  document.querySelector(".begin-test").addEventListener("click", testContent);
  document.querySelector(".cancel").addEventListener("click", testDescription);
});