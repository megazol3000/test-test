'use strict';

var screenLink = document.querySelector('.screen__link');
var burger = document.querySelector('.nav__burger');
var nav = document.querySelector('.nav');
var arrow = document.querySelector('.nav__arrow');
var screen = document.querySelector('.screen');
var navList = document.querySelector('.test-list');
var ul = document.querySelector('.test-list__ul');
var mobileBurger = document.querySelector('.mobile-nav__burger');
var mobileArrow = document.querySelector('.mobile-nav__arrow');
var screenBegin = document.querySelector('.screen-begin');
var screenContent = document.querySelector('.screen-content');

// Данные по тестам

var testsArray = [{
    id: 1,
    name: "Test's name",
    description: "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer ullamcorper volutpat tristique. Fusce et nunc porttitor, pretium urna at, sagittis purus. Nullam sagittis congue sapien non sodales. Aliquam vel condimentum lacus, sit amet feugiat velit. Suspendisse congue imperdiet dui, sit amet cursus mi viverra sed. Nam porttitor venenatis vehicula. Vestibulum sed arcu vel lorem venenatis tempor.",
    timer: 0,
    questions: [['Вопрос 1', 'Вариант А', 'Вариант Б', 'Вариант В', 'Вариант Г', 'Вариант Д', 'Вариант Е', 'Вариант Б', 'Не ответили'], ['Вопрос 2', 'Вариант А', 'Вариант Б', 'Вариант В', 'Вариант Г', 'Вариант Д', 'Вариант Е', 'Вариант А', 'Не ответили'], ['Вопрос 3', 'Вариант А', 'Вариант Б', 'Вариант В', 'Вариант Г', 'Вариант Д', 'Вариант Е', 'Вариант Е', 'Не ответили'], ['Вопрос 4', 'Вариант А', 'Вариант Б', 'Вариант В', 'Вариант Г', 'Вариант Д', 'Вариант Е', 'Вариант Д', 'Не ответили'], ['Вопрос 5', 'Вариант А', 'Вариант Б', 'Вариант В', 'Вариант Г', 'Вариант Д', 'Вариант Е', 'Вариант В', 'Не ответили']]
}, {
    id: 2,
    name: "Another Test",
    description: "Integer ullamcorper volutpat tristique. Fusce et nunc porttitor, pretium urna at, sagittis purus. Nullam sagittis congue sapien non sodales. Aliquam vel condimentum lacus, sit amet feugiat velit. Suspendisse congue imperdiet dui.",
    timer: 0,
    questions: [['Вопрос 1', 'Вариант А', 'Вариант Б', 'Вариант В', 'Вариант Г', 'Вариант Д', 'Вариант Е', 'Вариант В', 'Не ответили'], ['Вопрос 2', 'Вариант А', 'Вариант Б', 'Вариант В', 'Вариант Г', 'Вариант Д', 'Вариант Е', 'Вариант В', 'Не ответили'], ['Вопрос 3', 'Вариант А', 'Вариант Б', 'Вариант В', 'Вариант Г', 'Вариант Д', 'Вариант Е', 'Вариант А', 'Не ответили']]
}, {
    id: 3,
    name: "Test",
    description: "Aliquam vel condimentum lacus, sit amet feugiat velit. Suspendisse congue imperdiet dui.",
    timer: 0,
    questions: [['Вопрос 1', 'Вариант А', 'Вариант Б', 'Вариант В', 'Вариант Г', 'Вариант Д', 'Вариант Е', 'Вариант Б', 'Не ответили'], ['Вопрос 2', 'Вариант А', 'Вариант Б', 'Вариант В', 'Вариант Г', 'Вариант Д', 'Вариант Е', 'Вариант А', 'Не ответили'], ['Вопрос 3', 'Вариант А', 'Вариант Б', 'Вариант В', 'Вариант Г', 'Вариант Д', 'Вариант Е', 'Вариант Е', 'Не ответили'], ['Вопрос 4', 'Вариант А', 'Вариант Б', 'Вариант В', 'Вариант Г', 'Вариант Д', 'Вариант Е', 'Вариант Д', 'Не ответили'], ['Вопрос 5', 'Вариант А', 'Вариант Б', 'Вариант В', 'Вариант Г', 'Вариант Д', 'Вариант Е', 'Вариант В', 'Не ответили'], ['Вопрос 6', 'Вариант А', 'Вариант Б', 'Вариант В', 'Вариант Г', 'Вариант Д', 'Вариант Е', 'Вариант Б', 'Не ответили'], ['Вопрос 7', 'Вариант А', 'Вариант Б', 'Вариант В', 'Вариант Г', 'Вариант Д', 'Вариант Е', 'Вариант А', 'Не ответили'], ['Вопрос 8', 'Вариант А', 'Вариант Б', 'Вариант В', 'Вариант Г', 'Вариант Д', 'Вариант Е', 'Вариант Е', 'Не ответили'], ['Вопрос 9', 'Вариант А', 'Вариант Б', 'Вариант В', 'Вариант Г', 'Вариант Д', 'Вариант Е', 'Вариант Д', 'Не ответили'], ['Вопрос 10', 'Вариант А', 'Вариант Б', 'Вариант В', 'Вариант Г', 'Вариант Д', 'Вариант Е', 'Вариант В', 'Не ответили'], ['Вопрос 11', 'Вариант А', 'Вариант Б', 'Вариант В', 'Вариант Г', 'Вариант Д', 'Вариант Е', 'Вариант В', 'Не ответили']]
}];

localStorage.setItem('allTests', JSON.stringify(testsArray));
var raw = localStorage.getItem('allTests');
var tests = JSON.parse(raw);

console.log(tests);

//выводим список тестов в навигации

for (var i = 0; i < tests.length; i++) {
    ul.innerHTML += '<li class="test-list__item">' + tests[i].name + '</li>';
}
var navListItems = document.querySelectorAll('.test-list__item');

// выводим описание теста

var _loop = function _loop(_i) {
    navListItems[_i].addEventListener('click', function () {
        screenContent.innerHTML = '\n        <div class="screen-description">\n            <div class="screen-description-title">Описание</div>\n            <div class="screen-description-text">\n                <p>\n                    ' + tests[_i].description + '\n                </p>\n            </div>\n            <div class="screen-description-buttons">\n                <button class="btn begin-test">Начать</button><button class="btn cancel">Отмена</button>\n            </div>\n        </div>\n    ';
    });
};

for (var _i = 0; _i < navListItems.length; _i++) {
    _loop(_i);
}

// Обрабатываем кнопку "Отмена"

function testDescription() {
    screenContent.innerHTML = '\n    <div class="screen-begin">\n        <a class="screen__link" href="#">Выберите тест из списка</a>\n    </div>';
    var screenLink2 = document.querySelector('.screen__link');
    screenLink2.addEventListener('click', openNav);
    for (var j = 0; j < navListItems.length; j++) {
        navListItems[j].classList.remove('test-list__item_active');
    }
}

// Выводим тест

function testContent() {
    closeNav();

    var _loop2 = function _loop2(_i2) {
        if (navListItems[_i2].classList.contains('test-list__item_active')) {
            (function () {
                var time = function time() {
                    if (sec <= 8) {
                        timer.innerHTML = '0' + hours + ':0' + min + ':0' + (sec += 1);
                    } else if (sec >= 9 && sec <= 58) {
                        timer.innerHTML = '0' + hours + ':0' + min + ':' + (sec += 1);
                    } else if (sec >= 59) {
                        sec = -1;
                        min += 1;
                        timer.innerHTML = '0' + hours + ':0' + min + ':0' + (sec += 1);
                    }
                };

                var headCounter = '<span class="header-counter">0</span>';
                screenContent.innerHTML = '\n            <div class="screen-test">\n                <div class="screen-test-title">\n                    <div class="screen-test-title1"><button class="exit-btn test-btn">Выход</button></div>\n                    <h2> ' + tests[_i2].name + '</h2>\n                    <div class="test-nav">\n                        <button class="clear test-btn">Сбросить все ответы</button>\n                        <span class="test-counter">' + headCounter + '/' + tests[_i2].questions.length + '</span>\n                        <span class="test-timer">00:00:00</span>\n                    </div>\n                </div>\n                <div class="screen-test-forms">\n                <div class="screen-test-result">\n                </div>\n                    \n                </div>\n                <div class="screen-test-footer">\n                    <button class="btn complete-test">Завершить</button>\n                </div>\n            </div>\n            ';
                var testForm = document.querySelector('.screen-test-forms');
                var timer = document.querySelector('.test-timer');

                var hours = 0;
                var min = 0;
                var sec = 0;

                setInterval(time, 1000);
                //Выводим строки теста

                var _loop3 = function _loop3(j) {
                    testForm.innerHTML += '\n                <p class="form-question">' + tests[_i2].questions[j][0] + '</p>\n                <form class="form">\n                    <div class="form-inputs">\n                    <input class="radio" type="radio" id="' + ("var" + j) + '" name="' + ("var" + j) + '" value="' + tests[_i2].questions[j][1] + '"><label for="' + ("var" + j) + '">' + tests[_i2].questions[j][1] + '</label>\n                    <input class="radio" type="radio" id="' + ("var" + j + 1) + '" name="' + ("var" + j) + '" value="' + tests[_i2].questions[j][2] + '"><label for="' + ("var" + j + 1) + '">' + tests[_i2].questions[j][2] + '</label>\n                    <input class="radio" type="radio" id="' + ("var" + j + 2) + '" name="' + ("var" + j) + '" value="' + tests[_i2].questions[j][3] + '"><label for="' + ("var" + j + 2) + '">' + tests[_i2].questions[j][3] + '</label>\n                    <input class="radio" type="radio" id="' + ("var" + j + 3) + '" name="' + ("var" + j) + '" value="' + tests[_i2].questions[j][4] + '"><label for="' + ("var" + j + 3) + '">' + tests[_i2].questions[j][4] + '</label>\n                    <input class="radio" type="radio" id="' + ("var" + j + 4) + '" name="' + ("var" + j) + '" value="' + tests[_i2].questions[j][5] + '"><label for="' + ("var" + j + 4) + '">' + tests[_i2].questions[j][5] + '</label>\n                    <input class="radio" type="radio" id="' + ("var" + j + 5) + '" name="' + ("var" + j) + '" value="' + tests[_i2].questions[j][6] + '"><label for="' + ("var" + j + 5) + '" style="margin:0;">' + tests[_i2].questions[j][6] + '</label>\n                   </div>\n                </form>';

                    // Обрабатываем кнопку "очистить"

                    var clearButton = document.querySelector('.clear');
                    var radioInput = document.querySelectorAll('.radio');
                    var headCounter = 0;
                    var headCounterDom = document.querySelector('.header-counter');

                    for (var k = 0; k < radioInput.length; k++) {
                        radioInput[k].addEventListener('change', function () {
                            if (headCounter < tests[_i2].questions.length) {
                                headCounter += 1;
                                headCounterDom.innerHTML = headCounter;
                            }
                            clearButton.addEventListener('click', function () {
                                headCounter = 0;
                                headCounterDom.innerHTML = headCounter;
                                for (var _k = 0; _k < radioInput.length; _k++) {
                                    radioInput[_k].checked = false;
                                }
                            });
                        });
                    }
                };

                for (var j = 0; j < tests[_i2].questions.length; j++) {
                    _loop3(j);
                }

                // Выводим результат

                var completeTest = document.querySelector('.complete-test');
                completeTest.addEventListener('click', function () {

                    var forms = document.querySelectorAll('.form-inputs');
                    for (var n = 0; n < forms.length; n++) {
                        for (var k = 0; k < 12; k++) {
                            if (forms[n].childNodes[1].checked) {
                                tests[_i2].questions[n][8] = forms[n].childNodes[1].value;
                            } else if (forms[n].childNodes[4].checked) {
                                tests[_i2].questions[n][8] = forms[n].childNodes[4].value;
                            } else if (forms[n].childNodes[7].checked) {
                                tests[_i2].questions[n][8] = forms[n].childNodes[7].value;
                            } else if (forms[n].childNodes[10].checked) {
                                tests[_i2].questions[n][8] = forms[n].childNodes[10].value;
                            } else if (forms[n].childNodes[13].checked) {
                                tests[_i2].questions[n][8] = forms[n].childNodes[13].value;
                            } else if (forms[n].childNodes[16].checked) {
                                tests[_i2].questions[n][8] = forms[n].childNodes[16].value;
                            }
                        }
                    }

                    testForm.innerHTML = '<div class="screen-test-result"></div>';
                    var resultTest = document.querySelector('.screen-test-result');
                    resultTest.style.height = "115px";
                    var counterAns = 0;

                    for (var _j = 0; _j < tests[_i2].questions.length; _j++) {
                        if (tests[_i2].questions[_j][7] == tests[_i2].questions[_j][8]) {
                            counterAns += 1;
                        }
                    }

                    resultTest.innerHTML = '\n                        <h2>Тест завершен</h2>\n                        <span>вы ответили правильно на ' + counterAns + ' вопросов из ' + tests[_i2].questions.length + '</span>\n                        <p>Ваши ответы</p>\n                    ';

                    for (var _j2 = 0; _j2 < tests[_i2].questions.length; _j2++) {
                        testForm.innerHTML += '\n                        <div class="screen-result-item">\n                        <p class="form-question">' + tests[_i2].questions[_j2][0] + '</p>\n                                <span>Правильный ответ: ' + tests[_i2].questions[_j2][7] + '</span>\n                                <span>Вы ответили: ' + tests[_i2].questions[_j2][8] + '</span>\n                        </div>\n                        ';
                    }
                    var footer = document.querySelector('.screen-test-footer');
                    footer.innerHTML = '<button class="btn again">Пройти еще раз</button>';

                    var againBtn = document.querySelector('.again');
                    againBtn.addEventListener('click', testContent);
                    againBtn.addEventListener('click', function () {
                        for (var e = 0; e < tests[_i2].questions.length; e++) {
                            tests[_i2].questions[e][8] = 'Не ответили';
                        }
                    });
                });
            })();
        }
    };

    for (var _i2 = 0; _i2 < navListItems.length; _i2++) {
        _loop2(_i2);
    }

    // Модальное окно

    var exitBtn = document.querySelector('.exit-btn');
    var darkWrap = document.querySelector('.dark-wrap');
    exitBtn.addEventListener('click', function () {
        darkWrap.style.display = 'block';
        var formExit = document.querySelector('.form-exit');
        var formCancel = document.querySelector('.form-cancel');

        formCancel.addEventListener('click', function () {
            darkWrap.style.display = 'none';
        });

        formExit.addEventListener('click', function () {
            testDescription();
            darkWrap.style.display = 'none';
        });
    });
}

// поведение кнопок и навигации

function openNav() {
    burger.classList.remove('nav__burger_active');
    mobileBurger.classList.remove('mobile-nav__burger_active');
    mobileArrow.classList.add('mobile-nav__arrow_active');
    nav.classList.add('screen__nav_active');
    screen.classList.add('screen_slim');
    navList.classList.remove('test-list_invisible');
}

function closeNav() {
    burger.classList.add('nav__burger_active');
    mobileBurger.classList.add('mobile-nav__burger_active');
    mobileArrow.classList.remove('mobile-nav__arrow_active');
    burger.classList.add('nav__burger_active');
    nav.classList.remove('screen__nav_active');
    screen.classList.remove('screen_slim');
    navList.classList.add('test-list_invisible');
}

screenLink.addEventListener('click', openNav);
burger.addEventListener('click', openNav);
arrow.addEventListener('click', closeNav);
mobileArrow.addEventListener('click', closeNav);
mobileBurger.addEventListener('click', openNav);

var _loop4 = function _loop4(_i3) {
    navListItems[_i3].addEventListener('click', function () {
        var screenWidth = window.screen.width;
        if (screenWidth <= 700) {
            closeNav();
        }
        screenBegin.classList.add('screen-description');
        for (var j = 0; j < navListItems.length; j++) {
            navListItems[j].classList.remove('test-list__item_active');
        }
        navListItems[_i3].classList.toggle('test-list__item_active');
        var beginTest = document.querySelector('.begin-test');
        beginTest.addEventListener('click', testContent);
        var cancelBtn = document.querySelector('.cancel');
        cancelBtn.addEventListener('click', testDescription);
    });
};

for (var _i3 = 0; _i3 < navListItems.length; _i3++) {
    _loop4(_i3);
}